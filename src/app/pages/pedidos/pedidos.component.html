<div class="bg-gray-100 font-sans min-h-screen">
  <div class="container mx-auto px-4 py-8">

    <!-- CABEÇALHO -->
    <div class="flex flex-col md:flex-row items-center justify-between mb-6 gap-4">
      <div>
      <h1 class="text-3xl font-bold text-gray-800">{{ tituloPagina() }}</h1>
            <h3 *ngIf="!isToggled()" class="text-gray-600 pt-4">Você comprou os seguintes itens:</h3>
            <h3 *ngIf="isToggled()" class="text-gray-600 pt-4"> Você vendeu os seguintes itens:</h3>
      </div>
      <div class="flex items-center space-x-4">
        <div>
          <span class="text-gray-600 font-medium">Compras</span>
        </div>
        <button
          (click)="toggle()"
          class="relative flex items-center h-8 w-16 rounded-full transition-colors duration-300 ease-in-out cursor-pointer focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
          [ngClass]="{ 'bg-green-500': isToggled(), 'bg-blue-500': !isToggled() }"
        >
          <span
            class="transform transition-transform duration-300 ease-in-out w-6 h-6 bg-white rounded-full shadow-md"
            [ngClass]="{ 'translate-x-9': isToggled(), 'translate-x-1': !isToggled() }"
          ></span>
        </button>
        <div>
          <span class="text-gray-600 font-medium">Vendas</span>
        </div>
      </div>
    </div>

    <!-- ESTADO DE CARREGAMENTO -->
    <div *ngIf="loading()" class="text-center py-12">
      <p class="text-gray-500 text-lg">Carregando pedidos...</p>
    </div>

    <!-- ESTADO VAZIO -->
    <div *ngIf="!loading() && pedidos().length === 0" class="bg-white p-8 rounded-lg shadow-sm text-center text-gray-500">
      <p class="text-xl">Nenhum pedido encontrado</p>
      <p class="mt-2">Não há itens para a categoria "{{ tituloPagina() | lowercase }}".</p>
    </div>

    <!-- LISTA DE PEDIDOS -->
    <div *ngIf="!loading() && pedidos().length > 0" class="space-y-4">
      <div *ngFor="let pedido of pedidos()" class="bg-white p-6 rounded-lg shadow-sm grid grid-cols-1 md:grid-cols-3 gap-6 items-center">
        <!-- Coluna Esquerda: Detalhes do Produto -->
        <div class="md:col-span-2">
          <div class="flex items-center justify-between mb-4">
            <p class="text-sm text-gray-500">Pedido em: {{ formatarData(pedido.pedido.dataCriacao) }}</p>
            <span class="text-sm bg-green-100 text-green-700 font-semibold px-2 py-1 rounded-full">Entregue</span>
          </div>

          <div class="flex items-start space-x-4">
            <div class="flex-shrink-0 w-24 h-24 bg-gray-200 rounded-lg">
              <img *ngIf="pedido.produto.imagem" [src]="pedido.produto.imagem" [alt]="pedido.produto.nome" class="w-full h-full object-cover rounded-lg" />
              <div *ngIf="!pedido.produto.imagem" class="w-full h-full flex items-center justify-center bg-gray-200 rounded-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
              </div>
            </div>
            <div>
              <p class="text-lg font-semibold text-gray-900">{{ pedido.produto.nome }}</p>
              <p class="text-sm text-gray-600 mt-1">Quantidade: {{ pedido.quantidade }}</p>
              <p class="text-md font-bold text-gray-800 mt-2">Total: R$ {{ pedido.produto.preco * pedido.quantidade | number: '1.2-2' }}</p>
            </div>
          </div>
        </div>

        <!-- Coluna Direita: Ações e Informações -->
        <div class="flex flex-col items-center md:items-end justify-between text-sm h-full">
          <div class="text-center md:text-right mb-4 md:mb-0">
            <p class="text-gray-500">{{ isToggled() ? 'Comprador:' : 'Vendedor:' }}</p>
            <p class="text-blue-600 font-medium">{{ isToggled() ? pedido.comprador.nome : pedido.vendedor.nome }}</p>
          </div>
          <div class="flex flex-col items-stretch space-y-2 w-full max-w-xs md:max-w-none">
            <button (click)="verDetalhesPedido(pedido.id)" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-150">
              {{ expandedPedidoId() === pedido.id ? 'Ocultar detalhes' : 'Ver detalhes pedido' }}
            </button>
            <button *ngIf="!isToggled()" (click)="redirecionarParaPerfil(pedido.vendedor.email)" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition duration-150">
              Ver perfil vendedor
            </button>

              <button *ngIf="isToggled()" (click)="redirecionarParaPerfil(pedido.comprador.email)" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition duration-150">
              Ver perfil comprador
            </button>
          </div>
        </div>

        <!-- Seção expansível -->

     <div *ngIf="!isToggled() && expandedPedidoId() === pedido.id" class="md:col-span-3 mt-4" [@expandCollapse]="expandedPedidoId() === pedido.id ? 'expanded' : 'collapsed'">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="flex justify-center md:justify-start">
          </div>
        </div>
             <div class="flex items-center justify-end ">
              <div class="relative overflow-x-auto ">
            <div class="container mx-auto p-4 md:p-8 bg-gray-100">
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

    <div class="lg:col-span-2 space-y-4">

      <div class="bg-white rounded-lg shadow-md p-4 flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <div>
            <h2 class="text-lg font-semibold"> {{ pedido.produto.nome }}</h2>
            <p class="text-sm text-gray-500"> {{pedido.quantidade}} un. <a href="#" class="text-blue-600 hover:underline">Ver detalhe</a></p>
            <p class="text-sm text-gray-600 leading-relaxed"><span class="font-bold"> {{ pedido.pedido.enderecoEntrega.rua }}, {{ pedido.pedido.enderecoEntrega.numero }}</span>, {{ pedido.pedido.enderecoEntrega.bairro }}, {{ pedido.pedido.enderecoEntrega.cidade }}, {{ pedido.pedido.enderecoEntrega.estado }}.</p>

          </div>
        </div>
        <div class="flex-shrink-0">
          <img [src]="pedido.produto.imagem" alt="Anker Logo" class="w-8 h-8 rounded-full">
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-4">
        <div class="text-green-600 font-bold mb-2">Status</div>
        <h3 class="text-2xl font-bold mb-1">Vendedor : {{ pedido.vendedor.nome }}</h3>
        <!--<button class="mt-4 px-4 py-2 border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 transition-colors">Comprar novamente</button>-->
        <button *ngIf="!isToggled()" (click)="redirecionarParaPerfil(pedido.vendedor.email)" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition duration-150">
              Ver perfil do vendedor
          </button>

      </div>

      <div class="bg-white rounded-lg shadow-md p-4">
        <div class="text-lg font-semibold mb-2">O que você achou do produto?</div>
        <div class="flex space-x-1 text-gray-400 text-2xl">
          <span class="hover:text-yellow-400 cursor-pointer">★</span>
          <span class="hover:text-yellow-400 cursor-pointer">★</span>
          <span class="hover:text-yellow-400 cursor-pointer">★</span>
          <span class="hover:text-yellow-400 cursor-pointer">★</span>
          <span class="hover:text-yellow-400 cursor-pointer">★</span>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-4">
        <div class="text-lg font-semibold mb-4">Ajuda com a compra</div>
        <ul class="divide-y divide-gray-200">
          <li class="py-3"><a href="#" class="text-blue-600 hover:underline">Opinar sobre o vendedor</a></li>
          <!--<li class="py-3"><a href="#" class="text-blue-600 hover:underline">Minha compra apresentou um problema</a></li>

          <li class="py-3"><a href="#" class="text-blue-600 hover:underline">Preciso de ajuda com a NF-e</a></li>-->
        </ul>
      </div>

    </div>

    <div class="lg:col-span-1 space-y-4">

      <div class="bg-white rounded-lg shadow-md p-4">
        <div class="flex items-center justify-between text-sm text-gray-600 mb-4">
          <span>Detalhe da compra</span>
          <a href="#" class="text-blue-600 hover:underline"></a>
        </div>
        <div class="flex items-center justify-between text-sm mb-2">
          <span> {{ formatarData(pedido.pedido.dataCriacao) }} | {{ pedido.id}} </span>
        </div>
        <div class="border-t border-gray-200 pt-4 space-y-3">
          <div class="flex justify-between items-center text-sm">
            <span class="text-gray-600">Produto</span>
            <span class="font-medium"> R$ {{ pedido.produto.preco }}</span>
          </div>
          <div class="flex justify-between items-center text-sm">
            <span class="text-gray-600">Frete</span>
            <span class="text-green-600 font-medium"> R$ 9,00 </span>
          </div>
          <div class="border-t border-gray-200 mt-3 pt-3 flex justify-between items-center font-bold">
            <span class="text-lg">Total</span>
            <div class="text-right">
                <span class="block text-lg"> {{ pedido.produto.preco + 9 }} </span>
                <span class="text-sm text-gray-500 font-normal">Pix</span>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-4">
          <div class="flex justify-between items-center cursor-pointer text-blue-600 hover:underline">
              <span>Detalhes do pagamento e envio</span>
              <span>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
              </span>
          </div>
      </div>
      <!--
      <div class="bg-white rounded-lg shadow-md p-4 text-center">
          <img src="path-to-ad-image.png" alt="Advertisement" class="mx-auto w-full max-w-sm rounded-lg">
      </div> -->

    </div>
  </div>
</div>
              </div>
          </div>
      </div>

        <div *ngIf="isToggled() && expandedPedidoId() === pedido.id" class="md:col-span-3 mt-4" [@expandCollapse]="expandedPedidoId() === pedido.id ? 'expanded' : 'collapsed'">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="flex justify-center md:justify-start">

          </div>
        </div>
             <div class="flex items-center justify-end ">
              <div class="relative overflow-x-auto ">
               <table class="w-full text-sm text-right rtl:text-right text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-white uppercase bg-blue-600 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th scope="col" class="px-6 py-3 font-bold">
                            Valor
                        </th>
                        <th scope="col" class="px-6 py-3 font-bold">
                            Coluna
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200">
                        <td class="px-6 py-4">
                            {{ pedido.comprador.nome}}
                        </td>
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                            Nome Comprador
                        </th>
                    </tr>
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200">
                        <td class="px-6 py-4">
                            {{ pedido.comprador.telefone}}
                        </td>
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                            Telefone Comprador
                        </th>
                    </tr>
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200">
                        <td class="px-6 py-4">
                            {{ pedido.comprador.email}}
                        </td>
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-now-rap dark:text-white">
                            Email Comprador
                        </th>
                    </tr>
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200">
                        <td class="px-6 py-4">
                            {{ pedido.pedido.enderecoEntrega.cep}}
                        </td>
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-now-rap dark:text-white">
                            Endereco CEP
                        </th>
                    </tr>
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200">
                        <td class="px-6 py-4">
                            {{ pedido.pedido.enderecoEntrega.estado}}
                        </td>
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-now-rap dark:text-white">
                            Endereco Estado
                        </th>
                    </tr>
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200">
                        <td class="px-6 py-4">
                            {{ pedido.pedido.enderecoEntrega.cidade}}
                        </td>
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-now-rap dark:text-white">
                            Endereco Cidade
                        </th>
                    </tr>
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200">
                        <td class="px-6 py-4">
                            {{ pedido.pedido.enderecoEntrega.cidade}}
                        </td>
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-now-rap dark:text-white">
                            Endereco Bairro
                        </th>
                    </tr>
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200">
                        <td class="px-6 py-4">
                            {{ pedido.pedido.enderecoEntrega.rua}} {{pedido.pedido.enderecoEntrega.numero}}
                        </td>
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-now-rap dark:text-white">
                            Endereco Rua, nº
                        </th>
                    </tr>
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200">
                        <td class="px-6 py-4">
                            {{ pedido.pedido.enderecoEntrega.complemento}}
                        </td>
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-now-rap dark:text-white">
                            Complemento
                        </th>
                    </tr>
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200">
                        <td class="px-6 py-4">
                            {{ pedido.pedido.enderecoEntrega.adicional}}
                        </td>
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-now-rap dark:text-white">
                            Adicional
                        </th>
                    </tr>
                </tbody>
            </table>
              </div>
          </div>
      </div>
    </div>

    <!-- PAGINAÇÃO -->
    <nav *ngIf="!loading() && totalPaginas() > 1" class="mt-8 flex justify-center" aria-label="Paginação">
      <ul class="flex h-10 items-center -space-x-px text-base">
        <li>
          <button (click)="paginaAnterior()" [disabled]="page() === 0" [ngClass]="{'cursor-not-allowed opacity-50': page() === 0}"
            class="ms-0 flex h-10 items-center justify-center rounded-s-lg border border-e-0 border-gray-300 bg-white px-4 leading-tight text-gray-500 hover:bg-gray-100">
            Anterior
          </button>
        </li>
        <li *ngFor="let p of paginasVisiveis()">
          <ng-container *ngIf="p !== null; else ellipsis">
            <button (click)="irParaPagina(p)" [ngClass]="{
                'z-10 bg-blue-600 text-white border-blue-600': page() === p,
                'bg-white text-gray-500 hover:bg-gray-100 border-gray-300': page() !== p
              }" class="flex h-10 items-center justify-center border px-4 leading-tight transition-colors">
              {{ p + 1 }}
            </button>
          </ng-container>
          <ng-template #ellipsis>
            <span class="flex h-10 items-center justify-center border border-gray-300 bg-white px-4 leading-tight text-gray-500">...</span>
          </ng-template>
        </li>
        <li>
          <button (click)="proximaPagina()" [disabled]="page() >= totalPaginas() - 1" [ngClass]="{'cursor-not-allowed opacity-50': page() >= totalPaginas() - 1}"
            class="flex h-10 items-center justify-center rounded-e-lg border border-gray-300 bg-white px-4 leading-tight text-gray-500 hover:bg-gray-100">
            Próxima
          </button>
        </li>

      </ul>
    </nav>
  </div>
</div>
